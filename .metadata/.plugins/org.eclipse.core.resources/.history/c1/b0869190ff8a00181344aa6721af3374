package datnt.runsystem.com.dao;

import java.sql.Connection;

import javax.sql.DataSource;

import org.apache.commons.dbcp.ConnectionFactory;
import org.apache.commons.dbcp.DriverManagerConnectionFactory;
import org.apache.commons.dbcp.PoolableConnectionFactory;
import org.apache.commons.dbcp.PoolingDataSource;
import org.apache.commons.pool.impl.GenericObjectPool;

public class ConnectionPool {
	
	private final String dbURL = "jdbc";
	
	private final String username = "datnt";
	private final String password = "";
	
	private int numConnection = 10;
	
	private GenericObjectPool<Connection> gPool = null;
	
	private static ConnectionPool instance   = null;
	private DataSource     datasource = null;
	
	private ConnectionPool() {
		
		this.gPool = new GenericObjectPool<>();
		this.gPool.setMaxActive(this.numConnection);
		ConnectionFactory connectionFactory = new DriverManagerConnectionFactory(this.dbURL, this.username, this.password);
		PoolableConnectionFactory pcf = new PoolableConnectionFactory(connectionFactory, gPool, null, null, false, true);
		this.datasource = new PoolingDataSource(this.gPool);
	}
	
	public static ConnectionPool getInstance() {
		
		if (instance == null) {
			instance = new ConnectionPool();
		}
		return instance;
	}
	
	public GenericObjectPool<Connection> getConnectionPool() {
		return this.gPool;
	}
	
	public DataSource getDataSource() {
		return this.datasource;
	}
}
